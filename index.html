import React, { useState, useEffect, useRef, useCallback } from 'react';
import { initializeApp } from 'firebase/app';
import { 
    getFirestore, 
    collection, 
    onSnapshot, 
    addDoc, 
    deleteDoc, 
    doc, 
    updateDoc, 
    getDocs, 
    writeBatch,
    query,
    orderBy
} from 'firebase/firestore';

// --- Firebase Configuration ---
// IMPORTANT: Replace this with your actual Firebase project configuration.
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID",
  storageBucket: "YOUR_PROJECT_ID.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId: "YOUR_APP_ID"
};

// --- Initialize Firebase ---
// NOTE: In a real app, you might want to handle the case where firebaseConfig is not set.
// For this example, we assume it will be replaced with actual credentials.
let app;
let db;
try {
    app = initializeApp(firebaseConfig);
    db = getFirestore(app);
} catch (error) {
    console.error("Firebase initialization error. Please provide your Firebase config.", error);
    // In a real app, you might show an error message to the user.
}


// --- Helper Functions for Firestore ---

// Function to seed initial data if collections are empty
const seedInitialData = async () => {
    if (!db) return;
    const requestsRef = collection(db, 'requests');
    const queueRef = collection(db, 'queue');
    
    const requestsSnap = await getDocs(requestsRef);
    const queueSnap = await getDocs(queueRef);

    if (requestsSnap.empty && queueSnap.empty) {
        console.log("Empty database detected. Seeding initial data...");
        const batch = writeBatch(db);

        // Sample Requests
        const sampleRequests = [
            { danceName: 'Electric Slide', songName: 'Electric Boogie', artist: 'Marcia Griffiths', customerName: 'Brenda', spotifyLink: '', createdAt: new Date() },
            { danceName: 'Two Step', songName: 'Any Man of Mine', artist: 'Shania Twain', customerName: 'Dave', spotifyLink: '', createdAt: new Date() },
        ];
        sampleRequests.forEach(req => {
            const docRef = doc(collection(db, 'requests'));
            batch.set(docRef, req);
        });

        // Sample Queue
        const sampleQueue = [
            { type: 'song', danceName: 'Tush Push', songName: 'Tush Push', artist: 'Trisha Yearwood', order: 1 },
            { type: 'event', danceName: 'Line Dance Lesson', songName: 'Teaching: Copperhead Road', artist: '', order: 2 },
            { type: 'song', danceName: 'Good Time', songName: 'Good Time', artist: 'Alan Jackson', order: 3 },
        ];
        sampleQueue.forEach(item => {
            const docRef = doc(collection(db, 'queue'));
            batch.set(docRef, item);
        });

        await batch.commit();
        console.log("Initial data seeded.");
    }
};


// --- React Components ---

// Generic Modal Component
const Modal = ({ show, onClose, title, children }) => {
    if (!show) {
        return null;
    }

    return (
        <div className="fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4">
            <div className="bg-gray-800 rounded-lg shadow-xl w-full max-w-md p-6 relative">
                <h2 className="text-2xl font-bold text-pink-400 mb-4">{title}</h2>
                <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-white text-2xl">&times;</button>
                {children}
            </div>
        </div>
    );
};

// Customer Song Request Form
const RequestForm = ({ onClose, tippingInfo }) => {
    const [danceName, setDanceName] = useState('');
    const [songName, setSongName] = useState('');
    const [artist, setArtist] = useState('');
    const [spotifyLink, setSpotifyLink] = useState('');
    const [customerName, setCustomerName] = useState('');
    const [showThanksModal, setShowThanksModal] = useState(false);

    const lineDances = [
        { name: 'Tush Push', song: 'Tush Push', artist: 'Trisha Yearwood' },
        { name: 'Copperhead Road', song: 'Copperhead Road', artist: 'Steve Earle' },
        { name: 'Watermelon Crawl', song: 'Watermelon Crawl', artist: 'Tracy Byrd' },
        { name: 'Boot Scootin\' Boogie', song: 'Boot Scootin\' Boogie', artist: 'Brooks & Dunn' },
    ];

    const handleLineDanceSelect = (e) => {
        const selectedDanceName = e.target.value;
        const dance = lineDances.find(d => d.name === selectedDanceName);
        if (dance) {
            setDanceName(dance.name);
            setSongName(dance.song);
            setArtist(dance.artist);
        } else {
            setDanceName('');
            setSongName('');
            setArtist('');
        }
    };

    const handleSubmit = async (e) => {
        e.preventDefault();
        if (!danceName || !songName || !artist || !customerName || !db) return;

        try {
            await addDoc(collection(db, 'requests'), {
                danceName,
                songName,
                artist,
                spotifyLink,
                customerName,
                createdAt: new Date(),
            });
            setShowThanksModal(true);
        } catch (error) {
            console.error("Error adding request: ", error);
            alert("Sorry, there was an issue submitting your request.");
        }
    };

    if (showThanksModal) {
        return (
            <div className="text-center">
                 <h2 className="text-2xl font-bold text-pink-400 mb-4">Thank You!</h2>
                <p className="text-gray-200 mb-4">Your request has been sent to the DJ.</p>
                {(tippingInfo?.venmo || tippingInfo?.cashapp) && (
                    <div className="border-t border-gray-600 pt-4 mt-4">
                        <p className="text-lg text-cyan-300 font-semibold mb-2">Enjoying the music? Tip the DJ!</p>
                        {tippingInfo.venmo && <a href={`https://venmo.com/${tippingInfo.venmo}`} target="_blank" rel="noopener noreferrer" className="block text-white bg-blue-600 hover:bg-blue-700 rounded-lg px-4 py-2 my-2">Venmo: @{tippingInfo.venmo}</a>}
                        {tippingInfo.cashapp && <a href={`https://cash.app/$${tippingInfo.cashapp}`} target="_blank" rel="noopener noreferrer" className="block text-white bg-green-500 hover:bg-green-600 rounded-lg px-4 py-2 my-2">Cash App: ${tippingInfo.cashapp}</a>}
                    </div>
                )}
                <button onClick={() => { setShowThanksModal(false); onClose(); }} className="mt-4 bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-4 rounded-lg w-full">
                    Close
                </button>
            </div>
        );
    }

    return (
        <form onSubmit={handleSubmit}>
            <div className="mb-4">
                <label htmlFor="line-dance-select" className="block text-cyan-300 text-sm font-bold mb-2">Quick Select a Line Dance</label>
                <select id="line-dance-select" onChange={handleLineDanceSelect} className="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white leading-tight focus:outline-none focus:shadow-outline border-gray-600">
                    <option value="">-- Select a Dance --</option>
                    {lineDances.map(dance => <option key={dance.name} value={dance.name}>{dance.name}</option>)}
                </select>
            </div>
            <p className="text-center text-gray-400 my-2">OR</p>
            <div className="mb-4">
                <label htmlFor="dance-name" className="block text-cyan-300 text-sm font-bold mb-2">Dance Name/Style*</label>
                <input type="text" id="dance-name" value={danceName} onChange={e => setDanceName(e.target.value)} required className="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white leading-tight focus:outline-none focus:shadow-outline border-gray-600" />
            </div>
            <div className="mb-4">
                <label htmlFor="song-name" className="block text-cyan-300 text-sm font-bold mb-2">Song Name*</label>
                <input type="text" id="song-name" value={songName} onChange={e => setSongName(e.target.value)} required className="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white leading-tight focus:outline-none focus:shadow-outline border-gray-600" />
            </div>
            <div className="mb-4">
                <label htmlFor="artist-name" className="block text-cyan-300 text-sm font-bold mb-2">Artist*</label>
                <input type="text" id="artist-name" value={artist} onChange={e => setArtist(e.target.value)} required className="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white leading-tight focus:outline-none focus:shadow-outline border-gray-600" />
            </div>
            <div className="mb-4">
                <label htmlFor="spotify-link" className="block text-cyan-300 text-sm font-bold mb-2">Spotify Link (Optional)</label>
                <input type="url" id="spotify-link" value={spotifyLink} onChange={e => setSpotifyLink(e.target.value)} className="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white leading-tight focus:outline-none focus:shadow-outline border-gray-600" />
            </div>
            <div className="mb-4">
                <label htmlFor="customer-name" className="block text-cyan-300 text-sm font-bold mb-2">Your Name*</label>
                <input type="text" id="customer-name" value={customerName} onChange={e => setCustomerName(e.target.value)} required className="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white leading-tight focus:outline-none focus:shadow-outline border-gray-600" />
            </div>
            <button type="submit" className="bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-4 rounded-lg w-full">Submit Request</button>
        </form>
    );
};

// DJ Login Form
const DJLogin = ({ onLogin, onClose }) => {
    const [djName, setDjName] = useState('');
    const [password, setPassword] = useState('');
    const [error, setError] = useState('');

    const handleLogin = (e) => {
        e.preventDefault();
        // Simple password check as per requirements
        if ((djName === 'Angie' || djName === 'Justin') && password === 'puppies') {
            onLogin();
        } else {
            setError('Invalid DJ Name or Password.');
        }
    };

    return (
        <form onSubmit={handleLogin}>
            {error && <p className="text-red-500 text-center mb-4">{error}</p>}
            <div className="mb-4">
                <label htmlFor="dj-name" className="block text-cyan-300 text-sm font-bold mb-2">DJ Name</label>
                <select id="dj-name" value={djName} onChange={e => setDjName(e.target.value)} required className="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white leading-tight focus:outline-none focus:shadow-outline border-gray-600">
                    <option value="">Select DJ</option>
                    <option value="Angie">Angie</option>
                    <option value="Justin">Justin</option>
                </select>
            </div>
            <div className="mb-4">
                <label htmlFor="dj-password" className="block text-cyan-300 text-sm font-bold mb-2">Password</label>
                <input type="password" id="dj-password" value={password} onChange={e => setPassword(e.target.value)} required className="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white leading-tight focus:outline-none focus:shadow-outline border-gray-600" />
            </div>
            <button type="submit" className="bg-cyan-500 hover:bg-cyan-600 text-gray-900 font-bold py-2 px-4 rounded-lg w-full">Login</button>
        </form>
    );
};

// Queue List (for both Customer and DJ)
const QueueList = ({ queue, isDjView, onReorder, onEdit, onDelete, onMove }) => {
    const dragItem = useRef(null);
    const dragOverItem = useRef(null);

    const handleDragStart = (e, index) => {
        dragItem.current = index;
        e.dataTransfer.effectAllowed = 'move';
    };

    const handleDragEnter = (e, index) => {
        dragOverItem.current = index;
    };

    const handleDragEnd = () => {
        if (dragItem.current !== null && dragOverItem.current !== null && dragItem.current !== dragOverItem.current) {
            onReorder(dragItem.current, dragOverItem.current);
        }
        dragItem.current = null;
        dragOverItem.current = null;
    };
    
    if (queue.length === 0) {
        return <div className="text-center text-gray-400 py-8">The queue is currently empty.</div>
    }

    return (
        <div className="space-y-3">
            {queue.map((item, index) => (
                <div 
                    key={item.id}
                    className={`flex items-center gap-4 p-3 rounded-lg shadow-md transition-all ${item.type === 'event' ? 'bg-pink-600 text-white' : 'bg-gray-700'} ${isDjView ? 'cursor-move' : ''}`}
                    draggable={isDjView}
                    onDragStart={(e) => handleDragStart(e, index)}
                    onDragEnter={(e) => handleDragEnter(e, index)}
                    onDragEnd={handleDragEnd}
                    onDragOver={(e) => e.preventDefault()}
                >
                    <div className="text-2xl font-bold text-cyan-300 w-8 text-center">{index + 1}</div>
                    <div className="w-12 h-12 bg-gray-800 rounded-md flex items-center justify-center text-3xl text-gray-500">
                        üéµ
                    </div>
                    <div className="flex-grow">
                        <p className={`font-bold text-lg ${item.type === 'event' ? 'text-white' : 'text-cyan-300'}`}>{item.danceName}</p>
                        <p className={`text-sm ${item.type === 'event' ? 'text-pink-200' : 'text-gray-300'}`}>{item.songName}</p>
                        <p className="text-xs text-gray-400">{item.artist}</p>
                    </div>
                    {isDjView && (
                        <div className="flex flex-col md:flex-row items-center gap-2">
                            <div className="flex flex-col">
                                <button onClick={() => onMove(index, 'up')} className="text-gray-300 hover:text-white">‚ñ≤</button>
                                <button onClick={() => onMove(index, 'down')} className="text-gray-300 hover:text-white">‚ñº</button>
                            </div>
                            <button onClick={() => onEdit(item)} className="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-1 px-2 rounded text-xs">Edit</button>
                            <button onClick={() => onDelete(item.id)} className="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-2 rounded text-xs">Delete</button>
                        </div>
                    )}
                </div>
            ))}
        </div>
    );
};


// Edit Queue Item Modal
const EditQueueItemModal = ({ item, onSave, onClose }) => {
    const [danceName, setDanceName] = useState(item.danceName);
    const [songName, setSongName] = useState(item.songName);
    const [artist, setArtist] = useState(item.artist);

    const handleSave = (e) => {
        e.preventDefault();
        onSave({ ...item, danceName, songName, artist });
    };

    return (
        <Modal show={true} onClose={onClose} title="Edit Queue Item">
            <form onSubmit={handleSave}>
                <div className="mb-4">
                    <label htmlFor="edit-dance-name" className="block text-cyan-300 text-sm font-bold mb-2">Dance Name/Style</label>
                    <input type="text" id="edit-dance-name" value={danceName} onChange={e => setDanceName(e.target.value)} required className="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white leading-tight focus:outline-none focus:shadow-outline border-gray-600" />
                </div>
                <div className="mb-4">
                    <label htmlFor="edit-song-name" className="block text-cyan-300 text-sm font-bold mb-2">Song/Event Info</label>
                    <input type="text" id="edit-song-name" value={songName} onChange={e => setSongName(e.target.value)} required className="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white leading-tight focus:outline-none focus:shadow-outline border-gray-600" />
                </div>
                <div className="mb-4">
                    <label htmlFor="edit-artist-name" className="block text-cyan-300 text-sm font-bold mb-2">Artist</label>
                    <input type="text" id="edit-artist-name" value={artist} onChange={e => setArtist(e.target.value)} className="shadow appearance-none border rounded w-full py-2 px-3 bg-gray-700 text-white leading-tight focus:outline-none focus:shadow-outline border-gray-600" />
                </div>
                <button type="submit" className="bg-cyan-500 hover:bg-cyan-600 text-gray-900 font-bold py-2 px-4 rounded-lg w-full">Save Changes</button>
            </form>
        </Modal>
    );
};


// --- Main App Component ---
export default function App() {
    // State
    const [isDjLoggedIn, setIsDjLoggedIn] = useState(false);
    const [queue, setQueue] = useState([]);
    const [requests, setRequests] = useState([]);
    const [tippingInfo, setTippingInfo] = useState({ venmo: '', cashapp: '' });
    
    // Modal visibility state
    const [showRequestModal, setShowRequestModal] = useState(false);
    const [showLoginModal, setShowLoginModal] = useState(false);
    const [editingItem, setEditingItem] = useState(null);

    // DJ Console specific state
    const [venmoUser, setVenmoUser] = useState('');
    const [cashappUser, setCashappUser] = useState('');
    const [tipSaveConfirm, setTipSaveConfirm] = useState(false);

    // --- Effects for Firebase Listeners ---
    useEffect(() => {
        if (!db) {
            console.log("Firestore not initialized, skipping data fetch.");
            return;
        }

        // Seed data on first load
        seedInitialData();

        // Queue listener
        const q = query(collection(db, "queue"), orderBy("order"));
        const unsubscribeQueue = onSnapshot(q, (snapshot) => {
            const queueData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setQueue(queueData);
        });

        // Requests listener
        const requestsQuery = query(collection(db, "requests"), orderBy("createdAt", "desc"));
        const unsubscribeRequests = onSnapshot(requestsQuery, (snapshot) => {
            const requestsData = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setRequests(requestsData);
        });

        // Tipping info listener
        const unsubscribeTipping = onSnapshot(doc(db, "settings", "tipping"), (doc) => {
            if (doc.exists()) {
                const data = doc.data();
                setTippingInfo(data);
                setVenmoUser(data.venmo || '');
                setCashappUser(data.cashapp || '');
            }
        });

        // Cleanup subscriptions on unmount
        return () => {
            unsubscribeQueue();
            unsubscribeRequests();
            unsubscribeTipping();
        };
    }, []);

    // --- DJ Actions ---
    const handleAddRequestToQueue = async (request, position) => {
        if (!db) return;
        const newQueueItem = {
            type: 'song',
            danceName: request.danceName,
            songName: request.songName,
            artist: request.artist,
            order: position === 'next' ? 0 : queue.length + 1,
        };

        const batch = writeBatch(db);
        
        // Add the new item
        const newDocRef = doc(collection(db, 'queue'));
        batch.set(newDocRef, newQueueItem);

        // If adding 'next', re-order existing items
        if (position === 'next') {
            queue.forEach(item => {
                const docRef = doc(db, 'queue', item.id);
                batch.update(docRef, { order: item.order + 1 });
            });
        }
        
        // Delete the original request
        const requestRef = doc(db, 'requests', request.id);
        batch.delete(requestRef);
        
        await batch.commit();
    };

    const handleDeleteRequest = async (id) => {
        if (!db) return;
        await deleteDoc(doc(db, 'requests', id));
    };

    const handleAddEventToQueue = async (eventName) => {
        if (!db) return;
        const note = prompt(`Add optional notes for "${eventName}":`);
        await addDoc(collection(db, 'queue'), {
            type: 'event',
            danceName: eventName,
            songName: note || '',
            artist: '',
            order: queue.length + 1,
        });
    };

    const handleSaveTippingInfo = async (e) => {
        e.preventDefault();
        if (!db) return;
        try {
            await updateDoc(doc(db, "settings", "tipping"), {
                venmo: venmoUser,
                cashapp: cashappUser,
            });
            setTipSaveConfirm(true);
            setTimeout(() => setTipSaveConfirm(false), 2000);
        } catch (error) {
            // If the doc doesn't exist, create it.
            if (error.code === 'not-found') {
                 await setDoc(doc(db, "settings", "tipping"), {
                    venmo: venmoUser,
                    cashapp: cashappUser,
                });
                setTipSaveConfirm(true);
                setTimeout(() => setTipSaveConfirm(false), 2000);
            } else {
                console.error("Error saving tipping info:", error);
            }
        }
    };
    
    const handleQueueReorder = useCallback(async (dragIndex, dropIndex) => {
        if (!db) return;
        const newQueue = [...queue];
        const [draggedItem] = newQueue.splice(dragIndex, 1);
        newQueue.splice(dropIndex, 0, draggedItem);

        const batch = writeBatch(db);
        newQueue.forEach((item, index) => {
            const docRef = doc(db, 'queue', item.id);
            batch.update(docRef, { order: index + 1 });
        });
        await batch.commit();
    }, [queue]);

    const handleMoveQueueItem = (index, direction) => {
        if (direction === 'up' && index > 0) {
            handleQueueReorder(index, index - 1);
        } else if (direction === 'down' && index < queue.length - 1) {
            handleQueueReorder(index, index + 1);
        }
    };
    
    const handleEditQueueItem = (item) => {
        setEditingItem(item);
    };

    const handleSaveEditedItem = async (updatedItem) => {
        if (!db) return;
        const { id, ...data } = updatedItem;
        await updateDoc(doc(db, 'queue', id), data);
        setEditingItem(null);
    };

    const handleDeleteQueueItem = async (id) => {
        if (!db || !window.confirm("Are you sure you want to delete this item from the queue?")) return;
        
        const itemToDelete = queue.find(item => item.id === id);
        if (!itemToDelete) return;

        const batch = writeBatch(db);
        const docRef = doc(db, 'queue', id);
        batch.delete(docRef);

        // Re-order subsequent items
        queue.forEach(item => {
            if (item.order > itemToDelete.order) {
                const itemRef = doc(db, 'queue', item.id);
                batch.update(itemRef, { order: item.order - 1 });
            }
        });

        await batch.commit();
    };

    // --- Render Logic ---

    if (!db) {
        return (
            <div className="bg-gray-900 text-white min-h-screen flex flex-col justify-center items-center">
                <h1 className="text-3xl text-red-500">Firebase Not Configured</h1>
                <p className="mt-4">Please replace the placeholder `firebaseConfig` in the code.</p>
            </div>
        );
    }

    if (isDjLoggedIn) {
        // DJ Console View
        return (
            <div className="bg-gray-900 text-white min-h-screen p-4 md:p-8">
                {editingItem && <EditQueueItemModal item={editingItem} onSave={handleSaveEditedItem} onClose={() => setEditingItem(null)} />}
                <header className="flex justify-between items-center mb-6 pb-4 border-b-2 border-cyan-400">
                    <h1 className="text-3xl md:text-4xl font-bold text-cyan-400">DJ Console</h1>
                    <button onClick={() => setIsDjLoggedIn(false)} className="bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-4 rounded-lg">Logout</button>
                </header>
                <div className="flex flex-col lg:flex-row gap-8">
                    {/* Left Column */}
                    <div className="lg:w-1/2 flex flex-col gap-6">
                        {/* Common Events */}
                        <div>
                            <h3 className="text-2xl font-semibold text-pink-400 mb-3">Common Events</h3>
                            <div className="grid grid-cols-2 gap-3">
                                {['Line Dance Lesson', 'Couples Dance', 'Last Call', 'Closing Time'].map(event => (
                                    <button key={event} onClick={() => handleAddEventToQueue(event)} className="bg-gray-700 hover:bg-gray-600 text-cyan-300 font-semibold p-3 rounded-lg text-center">{event}</button>
                                ))}
                            </div>
                        </div>
                        {/* Submitted Requests */}
                        <div>
                            <h3 className="text-2xl font-semibold text-pink-400 mb-3">Submitted Requests ({requests.length})</h3>
                            <div className="bg-gray-800 p-4 rounded-lg max-h-96 overflow-y-auto space-y-3">
                                {requests.length > 0 ? requests.map(req => (
                                    <div key={req.id} className="bg-gray-700 p-3 rounded-lg">
                                        <p><span className="font-bold text-cyan-300">{req.danceName}</span> - <span className="text-gray-300">{req.songName}</span> by <span className="italic text-gray-400">{req.artist}</span></p>
                                        <p className="text-sm text-gray-500">From: {req.customerName}</p>
                                        {req.spotifyLink && <a href={req.spotifyLink} target="_blank" rel="noopener noreferrer" className="text-green-400 text-sm hover:underline">Spotify Link</a>}
                                        <div className="flex gap-2 mt-2">
                                            <button onClick={() => handleAddRequestToQueue(req, 'next')} className="bg-green-600 hover:bg-green-700 text-white text-xs font-bold py-1 px-2 rounded">Add Next</button>
                                            <button onClick={() => handleAddRequestToQueue(req, 'last')} className="bg-blue-600 hover:bg-blue-700 text-white text-xs font-bold py-1 px-2 rounded">Add Last</button>
                                            <button onClick={() => handleDeleteRequest(req.id)} className="bg-red-600 hover:bg-red-700 text-white text-xs font-bold py-1 px-2 rounded">Delete</button>
                                        </div>
                                    </div>
                                )) : <p className="text-gray-400">No pending requests.</p>}
                            </div>
                        </div>
                        {/* Tipping Links */}
                         <div>
                            <h3 className="text-2xl font-semibold text-pink-400 mb-3">Tipping Links</h3>
                            <form onSubmit={handleSaveTippingInfo} className="bg-gray-800 p-4 rounded-lg space-y-3">
                                <input type="text" value={venmoUser} onChange={e => setVenmoUser(e.target.value)} placeholder="Venmo Username" className="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-400" />
                                <input type="text" value={cashappUser} onChange={e => setCashappUser(e.target.value)} placeholder="Cash App $Cashtag" className="w-full p-2 bg-gray-700 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-cyan-400" />
                                <div className="flex items-center gap-4">
                                    <button type="submit" className="bg-cyan-500 hover:bg-cyan-600 text-gray-900 font-bold py-2 px-4 rounded-lg">Save Tips</button>
                                    {tipSaveConfirm && <span className="text-green-400 text-2xl">‚úîÔ∏è</span>}
                                </div>
                            </form>
                        </div>
                    </div>
                    {/* Right Column */}
                    <div className="lg:w-1/2">
                        <h3 className="text-2xl font-semibold text-pink-400 mb-3">Live Dance Queue (Drag to Reorder)</h3>
                        <div className="bg-gray-800 p-4 rounded-lg min-h-[50vh]">
                            <QueueList queue={queue} isDjView={true} onReorder={handleQueueReorder} onEdit={handleEditQueueItem} onDelete={handleDeleteQueueItem} onMove={handleMoveQueueItem} />
                        </div>
                    </div>
                </div>
            </div>
        );
    }

    // Customer Facing View
    return (
        <div className="bg-gray-900 text-white min-h-screen">
            <Modal show={showRequestModal} onClose={() => setShowRequestModal(false)} title="Submit a Song Request">
                <RequestForm onClose={() => setShowRequestModal(false)} tippingInfo={tippingInfo} />
            </Modal>
            <Modal show={showLoginModal} onClose={() => setShowLoginModal(false)} title="DJ Login">
                <DJLogin onLogin={() => { setIsDjLoggedIn(true); setShowLoginModal(false); }} onClose={() => setShowLoginModal(false)} />
            </Modal>

            <div className="container mx-auto p-4 md:p-8">
                <header className="text-center mb-8">
                    <h1 className="text-5xl md:text-7xl font-extrabold" style={{ fontFamily: "'Brush Script MT', cursive", color: '#ff00ff' }}>
                        Neon Boots
                    </h1>
                    <p className="text-cyan-300 text-lg">Houston's Premier Country & Western Dance Club</p>
                    <div className="flex justify-center gap-4 mt-6">
                        <a href="https://www.neonbootsclub.com/" target="_blank" rel="noopener noreferrer" className="bg-transparent border-2 border-cyan-400 text-cyan-400 hover:bg-cyan-400 hover:text-gray-900 font-bold py-2 px-6 rounded-lg transition-colors">
                            Visit Website
                        </a>
                        <button onClick={() => setShowRequestModal(true)} className="bg-pink-500 hover:bg-pink-600 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                            Submit a Request
                        </button>
                    </div>
                </header>

                <main>
                    <h2 className="text-3xl font-bold text-center text-cyan-400 mb-4">Live Dance Queue</h2>
                    <div className="bg-gray-800 p-4 rounded-lg shadow-lg">
                        <QueueList queue={queue} isDjView={false} />
                    </div>
                </main>

                <footer className="text-center mt-8 pt-4 border-t border-gray-700">
                    <button onClick={() => setShowLoginModal(true)} className="text-gray-500 hover:text-cyan-300 transition-colors">
                        DJ Login
                    </button>
                </footer>
            </div>
        </div>
    );
}
