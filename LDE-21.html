<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Line Dance Extravaganza 21</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&family=Orbitron:wght@500;700&display=swap');

        :root {
            --neon-pink: #ff2a6d;
            --neon-blue: #05d9e8;
            --bg-dark: #050511;
            --card-bg: rgba(255, 255, 255, 0.05);
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-dark);
            color: white;
            -webkit-tap-highlight-color: transparent;
            display: flex;
            flex-direction: column;
            height: 100vh; /* Fallback */
            height: 100dvh; /* Dynamic height */
            overflow: hidden;
        }

        h1, h2, .neon-font {
            font-family: 'Orbitron', sans-serif;
        }

        /* Glass Card Style */
        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .neon-text-glow {
            text-shadow: 0 0 8px rgba(5, 217, 232, 0.6);
        }

        /* Boot Emoji Styles */
        .boot-emoji {
            opacity: 0.3; /* Dimmed by default */
            filter: grayscale(100%);
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-size: 1.75rem; /* 28px equivalent */
            cursor: pointer;
            display: inline-block;
            user-select: none;
        }
        
        .boot-emoji.active {
            opacity: 1;
            filter: grayscale(0%);
            transform: scale(1.2);
            text-shadow: 0 0 10px var(--neon-pink);
        }

        .boot-emoji:active {
            transform: scale(0.9);
        }

        /* --- RANGE SLIDER STYLING (RESTORED) --- */
        input[type=range] {
            -webkit-appearance: none; 
            width: 100%; 
            background: transparent; 
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            margin-top: -8px; 
            box-shadow: 0 0 10px rgba(255,255,255,0.8);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #333;
            border-radius: 2px;
        }

        /* Dynamic track colors */
        .slider-track-0::-webkit-slider-runnable-track { background: #4b5563; }
        .slider-track-1::-webkit-slider-runnable-track { background: linear-gradient(to right, #4b5563, #f59e0b); }
        .slider-track-2::-webkit-slider-runnable-track { background: linear-gradient(to right, #f59e0b, #05d9e8); }

        /* Hide scrollbar */
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }

        @keyframes pulse-mild {
            0%, 100% { transform: scale(1); opacity: 0.5; }
            50% { transform: scale(1.1); opacity: 1; text-shadow: 0 0 8px var(--neon-pink); color: white; }
        }
        
        .animate-pulse-mild {
            animation: pulse-mild 2.5s infinite ease-in-out;
        }

        /* Instructor headshot styling */
        .instructor-photo {
            width: 56px; /* w-14 size from tailwind */
            height: 56px; /* h-14 */
            border-radius: 9999px; /* rounded-full */
            object-fit: cover; /* Crop image to fill */
            box-shadow: 0 8px 18px rgba(0,0,0,0.35);
            border: 1px solid rgba(255,255,255,0.08);
            display: inline-block;
        }
    </style>
</head>
<body class="bg-[url('https://www.transparenttextures.com/patterns/stardust.png')]">

    <!-- Header Section (Header + Nav) -->
    <div class="flex-shrink-0 z-30 bg-black/90 backdrop-blur-md border-b border-white/10 shadow-lg">
        <!-- Title -->
        <header class="p-4 pb-2 text-center">
            <h1 class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-400 to-cyan-400 neon-text-glow tracking-wider">
                EXTRAVAGANZA 21
            </h1>
            <p class="text-[10px] text-cyan-300 uppercase tracking-[0.2em] mt-1">Dec 6 â€¢ Neon Boots â€¢ Houston</p>
        </header>

        <!-- Navigation -->
        <nav class="w-full pb-2">
            <div class="flex justify-around items-center h-12 max-w-md mx-auto px-4">
                <button onclick="renderSection('info')" class="nav-btn flex-1 flex flex-col items-center justify-center h-full text-cyan-400 transition-all active:scale-95 border-b-2 border-cyan-400" id="btn-info">
                    <span class="text-xs font-bold uppercase tracking-wider">Info</span>
                </button>
                <button onclick="renderSection('instructors')" class="nav-btn flex-1 flex flex-col items-center justify-center h-full text-gray-500 animate-pulse-mild transition-all active:scale-95 border-b-2 border-transparent" id="btn-instructors">
                    <span class="text-xs font-bold uppercase tracking-wider">Team</span>
                </button>
                <button id="btn-dances" onclick="handleSetListClick()" class="nav-btn flex-1 flex flex-col items-center justify-center h-full text-gray-500 animate-pulse-mild transition-all active:scale-95 border-b-2 border-transparent">
                    <span class="text-xs font-bold uppercase tracking-wider">Set List</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- Main Content Area (Scrollable) -->
    <main id="content-area" class="flex-1 overflow-y-auto p-4 space-y-5 scroll-smooth w-full max-w-3xl mx-auto">
        <!-- Content injects here -->
    </main>

    <!-- Script -->
    <script>
        // --- CONFIGURATION & DATA ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwzI6FxLgU16nqlDOut9TyxiBPuce645iQ0t52nOLcx9VPi6lg2odZB9vLCRmUtdks/exec";
        
        // DATE LOGIC: Check if today is Dec 6, 2025
        const EVENT_DATE_STR = "2025-12-06";
        const today = new Date();
        const todayStr = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0') + '-' + String(today.getDate()).padStart(2, '0');
        
        let isSurveyLive = (todayStr === EVENT_DATE_STR);
        // DEV OVERRIDE
        if (localStorage.getItem('dev_unlock') === 'true') {
            isSurveyLive = true;
        }

        const eventDetails = {
            date: "Saturday, December 6, 2025",
            time: "3:00 PM - 6:00 PM",
            location: "Neon Boots Dancehall & Saloon",
            address: "11410 Hempstead Rd, Houston, TX 77092",
            description: "Houston and Dallas Unite! The 21st Line Dance Extravaganza brings the heat with a massive instructor lineup. Mark your calendars for the ultimate Texas takeover with 3 hours of dancing and 20 walk throughs of our favorite dances!."
        };

        const guests = [
            { name: "Yoshi", group: "Round-Up Saloon, Dallas", type: "guest" },
            { name: "Juan", group: "Round-Up Saloon, Dallas", type: "guest" },
            { name: "Emily", group: "Round-Up Saloon, Dallas", type: "guest" },
            { name: "Britt", group: "Cross the Line Dancing, Houston", type: "guest", photo: "assets/images/britt.jpeg" }
        ];

        const neonRaw = ["Kimber", "John S", "John E", "Amanda", "Esteban", "Jasmin", "Justin", "Nickolas", "Mark"];
        const neonPhotos = {
            Amanda: "assets/images/amanda.jpg",
            Justin: "assets/images/justin.jpg"
        };
        const neonTeam = neonRaw.sort().map(name => ({
            name: name,
            group: "Neon Boots",
            type: "neon",
            photo: neonPhotos[name] || undefined
        }));

        const allInstructors = { guests, neonTeam };

        const dances = [
            { order: 1, name: "Twenty Two (22)", level: "Beginner", song: "You Look Like You Love Me", artist: "Ella Langley & Riley Green", taughtBy: "Kimber", sheet: "https://www.copperknob.co.uk/stepsheets/187529/twenty-two-22" },
            { order: 2, name: "Around the Fire", level: "Intermediate", song: "Old Country Barn", artist: "James Johnston", taughtBy: "John S", sheet: "https://www.copperknob.co.uk/stepsheets/176253/around-the-fire" },
            { order: 3, name: "Do It Like This", level: "Beginner", song: "Do It Like This", artist: "Daphne Willis", taughtBy: "John E", sheet: "https://www.copperknob.co.uk/stepsheets/do-it-like-this-ID124544.aspx" },
            { order: 4, name: "Heel Toe Rodeo", level: "Improver", song: "Cowboy Up", artist: "Kaylee Bell", taughtBy: "Amanda", sheet: "https://www.copperknob.co.uk/stepsheets/189852/heel-toe-rodeo" },
            { order: 5, name: "Take Me to the Beach", level: "Intermediate", song: "Take Me to the Beach", artist: "Imagine Dragons", taughtBy: "Esteban", sheet: "https://www.copperknob.co.uk/stepsheets/188882/take-me-to-the-beach" },
            { order: 6, name: "Liar", level: "Beginner", song: "Liar", artist: "Jelly Roll", taughtBy: "Demo", sheet: "https://www.copperknob.co.uk/stepsheets/188067/liar" },
            { order: 7, name: "He Set Her Off", level: "Intermediate", song: "He Set Her Off", artist: "Emily Ann Roberts", taughtBy: "Demo", sheet: "https://www.copperknob.co.uk/stepsheets/171386/he-set-her-off" },
            { order: 8, name: "Country Girl Shake", level: "Improver", song: "Country Girl (Shake It For Me)", artist: "Luke Bryan", taughtBy: "Jasmin", sheet: "https://www.copperknob.co.uk/stepsheets/82657/country-girl-shake" },
            { order: 9, name: "Bringin' The Wow", level: "Intermediate", song: "Bring The Wow", artist: "Kali J & Nathan Fields", taughtBy: "Juan (Guest)", sheet: "https://www.copperknob.co.uk/stepsheets/188753/bringin-the-wow" },
            { order: 10, name: "Champagne Promise", level: "Beginner", song: "Champagne Promise", artist: "David Nail", taughtBy: "Britt (Guest)", sheet: "https://www.copperknob.co.uk/stepsheets/117305/champagne-promise" },
            { order: 11, name: "Heartache on the Dance Floor", level: "Improver", song: "Heartache on the Dance Floor", artist: "Jon Pardi", taughtBy: "Nickolas", sheet: "https://www.copperknob.co.uk/stepsheets/heartache-on-the-dance-floor-ID116791.aspx" },
            { order: 12, name: "Somewhere With You", level: "Intermediate", song: "Somewhere With You", artist: "Kenny Chesney", taughtBy: "Mark", sheet: "https://www.copperknob.co.uk/stepsheets/81177/somewhere-with-you" },
            { order: 13, name: "Half Past Tipsy", level: "Improver", song: "1, 2 Many", artist: "Luke Combs & Brooks & Dunn", taughtBy: "Yoshi (Guest)", sheet: "https://www.copperknob.co.uk/stepsheets/half-past-tipsy-ID137347.aspx" },
            { order: 14, name: "Barn Dance (Mixer)", level: "Beginner", song: "Wild Wild West", artist: "The Escape Club", taughtBy: "Justin & Kimber", sheet: "" },
            { order: 15, name: "--- Two Step / WCS Break ---", level: "", song: "", artist: "", taughtBy: "Social", sheet: "" },
            { order: 18, name: "Amigos in Low Places", level: "Beginner", song: "Friends in Low Places", artist: "Robert Ray", taughtBy: "Britt (Guest)", sheet: "https://www.copperknob.co.uk/stepsheets/170697/amigos-in-low-places" },
            { order: 19, name: "Meet Me at The...", level: "Intermediate", song: "APT", artist: "Rose & Bruno Mars", taughtBy: "John E", sheet: "https://www.copperknob.co.uk/stepsheets/193723/meet-me-at-the" },
            { order: 20, name: "We Are Tonight", level: "Intermediate", song: "We Are Tonight", artist: "Billy Currington", taughtBy: "Amanda", sheet: "https://www.copperknob.co.uk/stepsheets/95128/we-are-tonight" },
            { order: 21, name: "Southern Gospel", level: "Intermediate", song: "Southern Gospel", artist: "Anne Wilson", taughtBy: "Kimber", sheet: "https://www.copperknob.co.uk/stepsheets/184589/southern-gospel" },
            { order: 22, name: "Stitches", level: "Improver", song: "Stitches", artist: "Shawn Mendes", taughtBy: "Yoshi (Guest)", sheet: "https://www.copperknob.co.uk/stepsheets/106984/stitches" },
            { order: 23, name: "Rhinestone Rock", level: "Intermediate", song: "Rhinestone Rock", artist: "Jenny Teator", taughtBy: "Emily (Guest)", sheet: "https://www.copperknob.co.uk/stepsheets/198435/rhinestone-rock" },
            { order: 24, name: "Ain't Home", level: "Intermediate", song: "Ain't Coming Home", artist: "Rodell Duff", taughtBy: "Jasmin", sheet: "https://www.copperknob.co.uk/stepsheets/199420/aint-home" },
            { order: 25, name: "Skiffle Time", level: "Intermediate", song: "Mama Don't Allow", artist: "The Jive Aces", taughtBy: "Mark", sheet: "https://www.copperknob.co.uk/stepsheets/skiffle-time-ID86031.aspx" },
            { order: 26, name: "Liquor Talking", level: "Intermediate", song: "Liquor Talkin", artist: "Don Louis", taughtBy: "Justin", sheet: "https://www.copperknob.co.uk/stepsheets/184590/liquor-talking" },
            { order: 27, name: "Cyber Drop (WDM 21)", level: "Intermediate", song: "Drop It to the Floor", artist: "Fletcher Kirkman", taughtBy: "Nickolas", sheet: "https://www.copperknob.co.uk/stepsheets/152918/cyber-drop-wdm-21" }
        ];

        // Global Rating State (Survey)
        let ratings = {}; 

        // --- READINESS SLIDER LOGIC (PERSISTENT) ---
        function getDanceStatus(danceName) {
            return localStorage.getItem('status_' + danceName) || 0;
        }

        function setDanceStatus(danceName, value) {
            localStorage.setItem('status_' + danceName, value);
        }

        window.updateStatus = function(slider, danceName, labelId) {
            const val = slider.value;
            setDanceStatus(danceName, val);
            
            slider.className = `slider-track-${val}`;
            
            const label = document.getElementById(labelId);
            if(val == 0) {
                label.innerText = "Not Yet";
                label.className = "text-[10px] uppercase font-bold text-gray-500 transition-colors";
            } else if (val == 1) {
                label.innerText = "Almost";
                label.className = "text-[10px] uppercase font-bold text-yellow-500 transition-colors";
            } else {
                label.innerText = "Let's Goooo!";
                label.className = "text-[10px] uppercase font-bold text-cyan-400 transition-colors";
            }
        };

        // --- BACKDOOR LOGIC ---
        let lastClickTime = 0;
        function handleSetListClick() {
            const currentTime = new Date().getTime();
            const timeDiff = currentTime - lastClickTime;

            if (timeDiff < 500) { 
                // Check current override status
                const isUnlocked = localStorage.getItem('dev_unlock') === 'true';
                
                if (isUnlocked) {
                    // Turn OFF
                    localStorage.removeItem('dev_unlock');
                    isSurveyLive = (todayStr === EVENT_DATE_STR); // Revert to date logic
                    alert("ðŸ”’ DEBUG MODE: Ratings Locked");
                } else {
                    // Turn ON
                    localStorage.setItem('dev_unlock', 'true');
                    isSurveyLive = true;
                    alert("ðŸ¤  DEBUG MODE: Ratings Unlocked!");
                }
            }
            lastClickTime = currentTime;
            renderSection('dances');
        }

        // --- INIT ---
        window.onload = function() {
            renderSection('info');
        }

        function renderSection(section) {
            const main = document.getElementById('content-area');
            main.innerHTML = '';
            
            // Reset Nav Styling
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-cyan-400', 'text-pink-500', 'animate-pulse-mild', 'border-cyan-400', 'border-pink-500');
                btn.classList.add('text-gray-500', 'border-transparent');
            });
            
            if(section === 'info') {
                const btn = document.getElementById('btn-info');
                btn.classList.add('text-cyan-400', 'border-cyan-400');
                btn.classList.remove('text-gray-500', 'border-transparent');
                
                document.getElementById('btn-instructors').classList.add('animate-pulse-mild');
                document.getElementById('btn-dances').classList.add('animate-pulse-mild');

                renderInfo(main);
            } else if(section === 'instructors') {
                const btn = document.getElementById('btn-instructors');
                btn.classList.add('text-pink-500', 'border-pink-500');
                btn.classList.remove('text-gray-500', 'border-transparent');
                renderInstructors(main);
            } else {
                const btn = document.getElementById('btn-dances');
                btn.classList.add('text-cyan-400', 'border-cyan-400');
                btn.classList.remove('text-gray-500', 'border-transparent');
                renderDances(main);
            }
        }

        function renderInfo(container) {
            const googleCalUrl = "https://calendar.google.com/calendar/render?action=TEMPLATE&text=Line+Dance+Extravaganza+21&dates=20251206T150000/20251206T180000&details=Houston+vs.+Dallas!+The+21st+edition+brings+the+heat+with+a+massive+instructor+lineup.&location=Neon+Boots+Dancehall+%26+Saloon,+11410+Hempstead+Rd,+Houston,+TX+77092&ctz=America/Chicago";

            container.innerHTML = `
                <div class="glass-card rounded-2xl p-6 text-center animate-fade-in border-t-4 border-pink-500">
                    <div class="w-16 h-16 mx-auto bg-gradient-to-tr from-pink-500 to-purple-600 rounded-full flex items-center justify-center mb-4 shadow-lg shadow-pink-500/20">
                        <i class="fas fa-calendar-check text-2xl text-white"></i>
                    </div>
                    <h2 class="text-2xl text-white mb-1 font-bold neon-font">Event Info</h2>
                    <p class="text-gray-400 text-sm mb-6">${eventDetails.description}</p>

                    <div class="space-y-4 text-left">
                        <div class="flex items-center bg-white/5 p-3 rounded-xl">
                            <i class="fas fa-clock text-cyan-400 text-xl mr-4 w-6 text-center"></i>
                            <div>
                                <p class="text-xs text-gray-400 uppercase font-bold">Time</p>
                                <p class="font-bold">${eventDetails.time}</p>
                            </div>
                        </div>
                        <div class="flex items-center bg-white/5 p-3 rounded-xl">
                            <i class="fas fa-map-pin text-pink-500 text-xl mr-4 w-6 text-center"></i>
                            <div>
                                <p class="text-xs text-gray-400 uppercase font-bold">Location</p>
                                <p class="font-bold">Neon Boots Dancehall</p>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 gap-3 mt-6">
                        <a href="${googleCalUrl}" target="_blank" class="block w-full bg-white/10 text-white font-bold uppercase tracking-widest py-4 rounded-xl hover:bg-white/20 transition border border-white/20 flex items-center justify-center gap-2">
                            <i class="fas fa-calendar-plus text-pink-500"></i> Add to Calendar
                        </a>
                        <a href="https://www.google.com/maps/search/?api=1&query=Neon+Boots+Dancehall+Houston" target="_blank" class="block w-full bg-gradient-to-r from-cyan-500 to-blue-600 text-black font-black uppercase tracking-widest py-4 rounded-xl hover:opacity-90 transition shadow-lg shadow-cyan-500/20 flex items-center justify-center gap-2">
                            <i class="fas fa-location-arrow"></i> Get Directions
                        </a>
                    </div>
                </div>
            `;
        }

        function renderInstructors(container) {
            let html = ``;
            
            html += `<div class="mb-6 animate-fade-in">
                <h2 class="text-sm font-bold text-pink-500 uppercase tracking-widest mb-3 pl-1">Special Guests</h2>`;
            allInstructors.guests.forEach(guest => {
                html += `
                    <div class="glass-card p-4 rounded-xl flex items-center space-x-4 mb-3 active:scale-[0.98] transition-transform animate-fade-in">
                                    ${guest.photo ? `
                                        <img src="${guest.photo}" alt="${guest.name} headshot" class="instructor-photo shrink-0" loading="lazy" decoding="async" width="56" height="56">
                                    ` : `
                                        <div class="w-14 h-14 rounded-full bg-gradient-to-br from-pink-600 to-purple-600 flex items-center justify-center text-white shadow-lg shrink-0">
                                            <span class="font-bold text-xl">${guest.name.charAt(0)}</span>
                                        </div>
                                    `}
                        <div>
                            <h3 class="font-bold text-lg text-white">${guest.name}</h3>
                            <p class="text-xs text-gray-400 uppercase tracking-wider font-semibold">${guest.group}</p>
                        </div>
                    </div>`;
            });
            html += `</div>`;

            html += `<div class="mb-8 animate-fade-in">
                <h2 class="text-sm font-bold text-cyan-400 uppercase tracking-widest mb-3 pl-1">Neon Boots Instructors</h2>`;
            allInstructors.neonTeam.forEach(member => {
                 html += `
                    <div class="glass-card p-4 rounded-xl flex items-center space-x-4 mb-3 active:scale-[0.98] transition-transform animate-fade-in">
                        ${member.photo ? `
                            <img src="${member.photo}" alt="${member.name} headshot" class="instructor-photo shrink-0" loading="lazy" decoding="async" width="56" height="56">
                        ` : `
                            <div class="w-14 h-14 rounded-full bg-gradient-to-br from-cyan-600 to-blue-600 flex items-center justify-center text-white shadow-lg shrink-0">
                                <span class="font-bold text-xl">${member.name.charAt(0)}</span>
                            </div>
                        `}
                        <div>
                            <h3 class="font-bold text-lg text-white">${member.name}</h3>
                            <p class="text-xs text-gray-400 uppercase tracking-wider font-semibold">${member.group}</p>
                        </div>
                    </div>`;
            });
            html += `</div>`;

            container.innerHTML = html;
        }

        function renderDances(container) {
            const searchHtml = `
                <div class="sticky top-0 bg-[#050511]/95 backdrop-blur-sm py-2 z-10 mb-2 animate-fade-in">
                    <div class="relative">
                        <i class="fas fa-search absolute left-4 top-3.5 text-gray-500"></i>
                        <input type="text" id="dance-search" placeholder="Filter dances..." 
                            class="w-full bg-white/10 text-white rounded-2xl py-3 pl-12 pr-4 focus:outline-none focus:ring-2 focus:ring-cyan-500 border border-white/5 placeholder-gray-500 text-sm font-semibold">
                    </div>
                </div>
                <div id="dance-list" class="space-y-4"></div>
            `;
            
            // Add Form container at the bottom if LIVE
            const bottomHtml = isSurveyLive ? `
                <div class="mt-10 mb-20 animate-fade-in glass-card p-6 rounded-2xl border-t-4 border-neon-pink">
                    <h3 class="text-xl font-bold text-white mb-4 text-center neon-font">Submit to DJ</h3>
                    
                    <div class="space-y-4 mb-6">
                        <div>
                            <label class="block text-xs uppercase text-gray-400 font-bold mb-1">Name (Optional)</label>
                            <input type="text" id="guest-name" placeholder="Your Name" class="w-full bg-black/30 rounded-lg p-3 text-white border border-white/10 focus:border-pink-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-xs uppercase text-gray-400 font-bold mb-1">Normally Dance At?</label>
                            <input type="text" id="guest-location" placeholder="e.g. Neon Boots, Round-Up" class="w-full bg-black/30 rounded-lg p-3 text-white border border-white/10 focus:border-pink-500 focus:outline-none">
                        </div>
                         <div>
                            <label class="block text-xs uppercase text-gray-400 font-bold mb-1">Other Comments?</label>
                            <input type="text" id="guest-comments" placeholder="Suggestions..." class="w-full bg-black/30 rounded-lg p-3 text-white border border-white/10 focus:border-pink-500 focus:outline-none">
                        </div>
                    </div>

                    <button onclick="submitRatings()" id="submit-btn" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 py-4 rounded-xl font-black uppercase tracking-widest text-white shadow-lg shadow-pink-500/30 active:scale-95 transition transform">
                        Send Ratings <i class="fas fa-paper-plane ml-2"></i>
                    </button>
                    <div id="submit-status" class="text-center mt-2 text-xs font-bold h-4"></div>
                </div>
            ` : '';

            container.innerHTML = searchHtml + bottomHtml;
            
            const listContainer = document.getElementById('dance-list');
            
            const renderList = (filterText = '') => {
                listContainer.innerHTML = '';
                const filtered = dances.filter(d => 
                    d.name.toLowerCase().includes(filterText) || 
                    d.song.toLowerCase().includes(filterText) || 
                    d.artist.toLowerCase().includes(filterText) ||
                    d.taughtBy.toLowerCase().includes(filterText)
                );

                if(filtered.length === 0) {
                    listContainer.innerHTML = `<div class="text-center py-10 opacity-50 animate-fade-in"><i class="fas fa-ghost text-4xl mb-2"></i><p>Nothing found</p></div>`;
                    return;
                }

                filtered.forEach(dance => {
                    // Fix for punctuation (escape single quotes for onclick handlers)
                    const safeName = dance.name.replace(/'/g, "\\'");

                    if(dance.name.includes('---')) {
                        listContainer.innerHTML += `
                            <div class="flex items-center justify-center py-4 animate-fade-in">
                                <div class="h-px bg-white/20 flex-1"></div>
                                <span class="px-4 text-xs text-cyan-300 uppercase tracking-widest font-bold">${dance.name.replace(/---/g, '').trim()}</span>
                                <div class="h-px bg-white/20 flex-1"></div>
                            </div>
                        `;
                        return;
                    }

                    let badgeClass = "bg-blue-500/20 text-blue-300 border-blue-500/30";
                    if(dance.level.toLowerCase() === 'beginner') badgeClass = "bg-green-500/20 text-green-300 border-green-500/30";
                    if(dance.level.toLowerCase() === 'improver') badgeClass = "bg-orange-500/20 text-orange-300 border-orange-500/30";

                    const spotifyLink = `https://open.spotify.com/search/${encodeURIComponent(dance.song + " " + dance.artist)}`;
                    const youtubeLink = `https://www.youtube.com/results?search_query=${encodeURIComponent(dance.song + " " + dance.artist)}`;
                    
                    // --- SLIDER STATE ---
                    const status = getDanceStatus(dance.name);
                    let statusLabel = "Not Yet";
                    let statusColor = "text-gray-500";
                    if(status == 1) { statusLabel = "Almost"; statusColor = "text-yellow-500"; }
                    if(status == 2) { statusLabel = "Let's Goooo!"; statusColor = "text-cyan-400"; }

                    // --- RATING UI (Conditional) ---
                    let ratingHtml = '';
                    if(isSurveyLive) {
                        const currentRating = ratings[dance.name] || 0;
                        let stars = '';
                        for(let i=1; i<=5; i++) {
                            const activeClass = i <= currentRating ? 'active' : '';
                            // Using the ðŸ‘¢ emoji inside a span
                            // Using safeName here to prevent 'Ain't Home' breakage
                            stars += `
                                <span class="boot-emoji ${activeClass}" onclick="setRating('${safeName}', ${i})">ðŸ‘¢</span>
                            `;
                        }
                        ratingHtml = `
                            <div class="mt-4 pt-4 border-t border-white/10">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-[10px] uppercase font-bold text-pink-500 tracking-widest">Rate this Dance</span>
                                    <span class="text-[10px] font-bold text-white" id="rating-text-${dance.name}">${currentRating > 0 ? currentRating + '/5 Boots' : 'Tap to rate'}</span>
                                </div>
                                <div class="flex justify-between px-2">
                                    ${stars}
                                </div>
                            </div>
                        `;
                    }

                    listContainer.innerHTML += `
                        <div class="glass-card rounded-2xl p-5 relative group overflow-hidden animate-fade-in">
                            <!-- Header: Dance Name & Number -->
                            <div class="flex justify-between items-start mb-1">
                                <h3 class="text-lg font-bold text-white leading-tight pr-6">${dance.name}</h3>
                                <span class="text-[10px] text-gray-500 font-mono block">#${dance.order}</span>
                            </div>

                            <!-- Song by Artist -->
                            <p class="text-xs text-gray-400 mb-3">${dance.song} by ${dance.artist}</p>

                            <!-- Instructor & Level Row -->
                            <div class="flex justify-between items-center mb-4">
                                <div class="flex items-center">
                                    <i class="fas fa-chalkboard-teacher text-pink-500 text-xs mr-2"></i>
                                    <span class="text-xs font-bold text-gray-300">${dance.taughtBy}</span>
                                </div>
                                <span class="inline-block px-2 py-0.5 rounded-md text-[10px] font-bold uppercase border ${badgeClass}">
                                    ${dance.level}
                                </span>
                            </div>

                            <!-- READINESS SLIDER (Always Visible) -->
                            <!-- Uses safeName for oninput as well -->
                            <div class="bg-black/20 rounded-xl p-3 mb-4">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-[10px] uppercase font-bold text-gray-500">Do you know it?</span>
                                    <span class="text-[10px] uppercase font-bold ${statusColor} transition-colors" id="label-${dance.order}">${statusLabel}</span>
                                </div>
                                <input type="range" min="0" max="2" step="1" value="${status}" 
                                    class="slider-track-${status}"
                                    oninput="updateStatus(this, '${safeName}', 'label-${dance.order}')">
                            </div>

                            <!-- Links -->
                            <div class="grid grid-cols-4 gap-2 mt-3">
                                <a href="${spotifyLink}" target="_blank" class="col-span-1 bg-white/5 hover:bg-[#1DB954]/20 py-2 rounded-lg flex items-center justify-center transition group/spot border border-white/5 hover:border-[#1DB954]/30 h-full">
                                    <i class="fab fa-spotify text-xl text-[#1DB954]"></i>
                                </a>

                                ${dance.sheet ? 
                                    `<a href="${dance.sheet}" target="_blank" class="col-span-2 bg-white/5 hover:bg-white/20 py-2 px-1 rounded-lg transition flex items-center justify-between gap-1 group/sheet border border-white/5 hover:border-white/20 h-full">
                                        <span class="text-[9px] font-black leading-none text-gray-400 group-hover/sheet:text-white text-right tracking-wider uppercase w-1/3">Demo<br>Videos</span>
                                        <img src="https://www.copperknob.co.uk/favicon.ico" class="w-6 h-6 object-contain">
                                        <span class="text-[9px] font-black leading-none text-gray-400 group-hover/sheet:text-white text-left tracking-wider uppercase w-1/3">Step<br>Sheet</span>
                                    </a>` : 
                                    `<div class="col-span-2 bg-black/20 py-2 rounded-lg flex items-center justify-center gap-2 opacity-30 border border-white/5 h-full">
                                        <i class="fas fa-file-excel text-xl text-gray-500"></i>
                                        <span class="text-[9px] font-black leading-none text-gray-500 text-left tracking-wider uppercase">No<br>Sheet</span>
                                    </div>`
                                }

                                <a href="${youtubeLink}" target="_blank" class="col-span-1 bg-white/5 hover:bg-[#FF0000]/20 py-2 rounded-lg flex items-center justify-center transition group/yt border border-white/5 hover:border-[#FF0000]/30 h-full">
                                    <i class="fab fa-youtube text-xl text-[#FF0000]"></i>
                                </a>
                            </div>

                            ${ratingHtml}
                        </div>
                    `;
                });
            };

            renderList();
            
            const searchInput = document.getElementById('dance-search');
            if(searchInput) {
                searchInput.addEventListener('input', (e) => renderList(e.target.value.toLowerCase()));
            }
        }

        // --- RATING LOGIC ---
        window.setRating = function(danceName, value) {
            ratings[danceName] = value;
            renderSection('dances'); 
        };

        window.submitRatings = function() {
            const btn = document.getElementById('submit-btn');
            const statusDiv = document.getElementById('submit-status');
            const name = document.getElementById('guest-name').value;
            const location = document.getElementById('guest-location').value;
            const comments = document.getElementById('guest-comments').value;

            if(Object.keys(ratings).length === 0) {
                statusDiv.innerText = "Please rate at least one dance!";
                statusDiv.className = "text-center mt-2 text-xs font-bold h-4 text-red-500";
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Sending...';
            
            const payload = {
                "Name (Opt)": name,
                "Where do you normally dance?": location,
                "Any other comments or suggestions?": comments,
                ...ratings
            };

            fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                body: JSON.stringify(payload)
            })
            .then(response => response.json())
            .then(data => {
                if(data.result === 'success') {
                    btn.innerHTML = 'SENT! ðŸ¤ ';
                    btn.classList.remove('from-pink-500', 'to-purple-600');
                    btn.classList.add('bg-green-500');
                    statusDiv.innerText = "Thanks for your feedback!";
                    statusDiv.className = "text-center mt-2 text-xs font-bold h-4 text-green-400";
                } else {
                    throw new Error('Script returned error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                btn.disabled = false;
                btn.innerHTML = 'Try Again';
                statusDiv.innerText = "Error sending. Please try again.";
                statusDiv.className = "text-center mt-2 text-xs font-bold h-4 text-red-500";
            });
        };

    </script>
</body>
</html>